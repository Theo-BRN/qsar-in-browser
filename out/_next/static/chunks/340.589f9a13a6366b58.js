"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{51772:function(t,e,r){r.d(e,{Z:function(){return Loader}});var a=r(85893),s=r(9008),n=r.n(s);function Loader(t){let{loadingText:e="Processsing..."}=t;return(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)(n(),{children:(0,a.jsx)("title",{children:e})}),e,(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"loader"})})]})}},45340:function(t,e,r){r.r(e),r.d(e,{default:function(){return PCAPlot}});var a=r(85893),s=r(67294),n=r(91315),i=r(93396);let PCA=class PCA{constructor(t,e={},r){let a;if(this.U=null,this.S=null,r){this.center=r.center,this.scale=r.scale,this.means=r.means,this.stdevs=r.stdevs,this.U=i.y3.checkMatrix(r.U),this.S=r.S,this.R=r.R,this.excludedFeatures=r.excludedFeatures||[];return}Array.isArray(t),a=new i.y3(t);let{isCovarianceMatrix:s=!1,method:n="SVD",nCompNIPALS:o=2,center:l=!0,scale:c=!1,ignoreZeroVariance:d=!1}=e;if(this.center=l,this.scale=c,this.means=null,this.stdevs=null,this.excludedFeatures=[],s){this._computeFromCovarianceMatrix(a);return}switch(this._adjust(a,d),n){case"covarianceMatrix":{let t=new i.tU(a).mmul(a).div(a.rows-1);this._computeFromCovarianceMatrix(t);break}case"NIPALS":this._computeWithNIPALS(a,o);break;case"SVD":{let t=new i.oH(a,{computeLeftSingularVectors:!1,computeRightSingularVectors:!0,autoTranspose:!0});this.U=t.rightSingularVectors;let e=t.diagonal,r=[];for(let t of e)r.push(t*t/(a.rows-1));this.S=r;break}default:throw Error(`unknown method: ${n}`)}}static load(t){if("string"!=typeof t.name)throw TypeError("model must have a name property");if("PCA"!==t.name)throw RangeError(`invalid model: ${t.name}`);return new PCA(void 0,void 0,t)}predict(t,e={}){let r;let{nComponents:a=this.U.columns}=e;if(Array.isArray(t),r=new i.y3(t),this.center&&(r.subRowVector(this.means),this.scale)){for(let t of this.excludedFeatures)r.removeColumn(t);r.divRowVector(this.stdevs)}let s=r.mmul(this.U);return s.subMatrix(0,s.rows-1,0,a-1)}invert(t){let e=(t=i.y3.checkMatrix(t)).mmul(this.U.transpose());return this.center&&(this.scale&&e.mulRowVector(this.stdevs),e.addRowVector(this.means)),e}getExplainedVariance(){let t=0;if(this.S)for(let e of this.S)t+=e;return this.S?this.S.map(e=>e/t):[]}getCumulativeVariance(){let t=this.getExplainedVariance();for(let e=1;e<t.length;e++)t[e]+=t[e-1];return t}getEigenvectors(){return this.U}getEigenvalues(){return this.S}getStandardDeviations(){return this.S.map(t=>Math.sqrt(t))}getLoadings(){return this.U.transpose()}toJSON(){return{name:"PCA",center:this.center,scale:this.scale,means:this.means,stdevs:this.stdevs,U:this.U,S:this.S,excludedFeatures:this.excludedFeatures}}_adjust(t,e){if(this.center){let r=t.mean("column"),a=this.scale?t.standardDeviation("column",{mean:r}):null;if(this.means=r,t.subRowVector(r),this.scale){for(let r=0;r<a.length;r++)if(0===a[r]){if(e)t.removeColumn(r),a.splice(r,1),this.excludedFeatures.push(r),r--;else throw RangeError(`Cannot scale the dataset (standard deviation is zero at index ${r}`)}this.stdevs=a,t.divRowVector(a)}}}_computeFromCovarianceMatrix(t){let e=new i.Ec(t,{assumeSymmetric:!0});this.U=e.eigenvectorMatrix,this.U.flipRows(),this.S=e.realEigenvalues,this.S.reverse()}_computeWithNIPALS(t,e){this.U=new i.y3(e,t.columns),this.S=[];let r=t;for(let t=0;t<e;t++){let e=new i.Ym(r);this.U.setRow(t,e.w.transpose()),this.S.push(Math.pow(e.s.get(0,0),2)),r=e.xResidual}this.U=this.U.transpose()}};var o=r(41983),l=r(51772);function PCAPlot(){let{ligand:t}=(0,s.useContext)(n.Z),[e,r]=(0,s.useState)(null);return((0,s.useEffect)(()=>{setTimeout(()=>{processCompounds()},"1000");let processCompounds=()=>{var e=t.map(t=>t.fingerprint);try{let t=new PCA(e),a=t.predict(e,{nComponents:2}),s=a.data.map(t=>{let[e,r]=t;return{x:e,y:r}});r(s)}catch(t){console.error("Error:",t)}}},[]),null===e)?(0,a.jsx)("div",{className:"main-container",children:(0,a.jsx)(l.Z,{})}):(0,a.jsxs)("div",{className:"main-container",children:[(0,a.jsx)("br",{}),e&&(0,a.jsx)(o.Z,{data:e,width:600,height:600,colorProperty:t.map(t=>t.pKi),hoverProp:t.map(t=>t.canonical_smiles),xAxisTitle:"Principal Component 2",yAxisTitle:"Principal Component 1"})]})}},41983:function(t,e,r){r.d(e,{Z:function(){return ScatterPlot}});var a=r(85893),s=r(67294),n=r(73877),components_D3ColorLegend=()=>{let t=(0,s.useRef)();return(0,s.useEffect)(()=>{(function(t,e){var r={top:10,right:2,bottom:20,left:60},a=n.Ys(t.current).style("height","50px").style("width","500px").style("position","relative").append("canvas").attr("height",1).attr("width",500-r.left-r.right).style("height",50-r.top-r.bottom+"px").style("width",500-r.left-r.right+"px").style("border","1px solid #000").style("position","absolute").style("top",r.top+"px").style("left",r.left+"px").node().getContext("2d"),s=n.BYU().range([0,500-r.left-r.right]).domain(e.domain()),i=a.createImageData(500-r.left-r.right,1);n.w6H(500-r.left-r.right).forEach(function(t){var r=n.B8C(e(s.invert(t)));i.data[4*t]=r.r,i.data[4*t+1]=r.g,i.data[4*t+2]=r.b,i.data[4*t+3]=255}),a.putImageData(i,0,0);var o=n.LLu().scale(s).tickSize(6).ticks(8);n.Ys(t.current).append("svg").attr("height","50px").attr("width","500px").style("position","absolute").style("left","0px").style("top","0px").append("g").attr("class","axis").attr("transform","translate("+r.left+","+(50-r.bottom)+")").call(o)})(t,n.cJy(n.OOA).domain([0,10]))},[]),(0,a.jsx)("div",{ref:t,id:"color-legend"})},i=r(5152),o=r.n(i);let l=o()(()=>Promise.all([r.e(662),r.e(216)]).then(r.bind(r,15216)),{loadableGenerated:{webpack:()=>[15216]},ssr:!1}),Tooltip=t=>{let{interactionData:e}=t;return null===e?null:(0,a.jsxs)("div",{style:{left:.5*e.xPos+10,bottom:.5*e.yPos},className:"tooltip",children:[(0,a.jsx)(l,{structure:e.name,id:"smiles"}),(0,a.jsx)("style",{children:'\n      .tooltip {\n        position: absolute;\n        background-color: rgba(0, 0, 0, 0.8);\n        border-radius: 4px;\n        color: white;\n        font-size: 12px;\n        padding: 4px;\n        margin-left: 15px;\n        transform: translateY(-50%);\n    }\n    \n    /* Add an arrow */\n    .tooltip:after {\n        content: "";\n        position:absolute;\n        border-width: 5px;  /* Arrow width */\n        left: -10px;  /* Arrow width * 2 */\n        top:50%;\n        transform:translateY(-50%);\n        border-color: transparent black transparent transparent;\n    }\n    \n      '})]})};var ScatterPlot=t=>{let{data:e,colorProperty:r,hoverProp:i,xAxisTitle:o,yAxisTitle:l}=t,c=(0,s.useRef)(),[d,h]=(0,s.useState)(null),handleMouseOver=(t,r)=>{let[a,s]=n.cx$(t);h({xPos:a,yPos:s,name:i[e.indexOf(r)]})},handleMouseEnd=()=>{h(null)};return(0,s.useEffect)(()=>{let t={top:10,right:30,bottom:30,left:60},a=800-t.left-t.right,s=600-t.top-t.bottom;n.Wem(e,t=>t.x),n.Wem(e,t=>t.y);let i=n.Ys(c.current).append("svg").attr("width",a+t.left+t.right).attr("height",s+t.top+t.bottom).append("g").attr("transform","translate(".concat(t.left,",").concat(t.top,")")),d=n.sPX().scaleExtent([.5,20]).extent([[0,0],[a,s]]).on("zoom",function(t){let e=t.transform.rescaleX(h),r=t.transform.rescaleY(u);p.call(n.LLu(e)),m.call(n.y4O(r)),f.selectAll("circle").attr("cx",t=>e(t.x)).attr("cy",t=>r(t.y))});i.append("rect").attr("width",a).attr("height",s).style("fill","none").style("pointer-events","all").attr("transform","translate(".concat(t.left,",").concat(t.top,")")).call(d);let h=n.BYU().domain([n.VV$(e,t=>t.x),n.Fp7(e,t=>t.x)]).range([0,a]),p=i.append("g").attr("transform","translate(0,".concat(s,")")).call(n.LLu(h)),u=n.BYU().domain([n.VV$(e,t=>t.y),n.Fp7(e,t=>t.y)]).range([s,0]),m=i.append("g").call(n.y4O(u));i.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",a).attr("height",s).attr("x",0).attr("y",0);let f=i.append("g").attr("clip-path","url(#clip)"),x=n.cJy().domain([1,10]).interpolator(n.OOA);f.selectAll("circle").data(e).enter().append("circle").attr("cx",t=>h(t.x)).attr("cy",t=>u(t.y)).attr("r",8).style("fill",(t,e)=>x(r[e])).style("opacity",.5).on("mouseenter",handleMouseOver).on("mouseleave",handleMouseEnd),i.append("text").attr("transform","translate(".concat(a/2,",").concat(s+t.top+20,")")).style("text-anchor","middle").style("fill","var(--text-color)").text(o),i.append("text").attr("transform","rotate(-90)").attr("y",0-t.left).attr("x",0-s/2).attr("dy","1em").style("text-anchor","middle").style("fill","var(--text-color)").text(l)},[e]),(0,a.jsxs)("div",{className:"container",style:{position:"relative"},children:[(0,a.jsx)(components_D3ColorLegend,{}),(0,a.jsx)("div",{id:"dataviz_axisZoom",ref:c}),(0,a.jsx)(Tooltip,{interactionData:d})]})}}}]);