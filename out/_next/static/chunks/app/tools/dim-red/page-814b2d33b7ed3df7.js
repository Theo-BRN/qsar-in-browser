(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{3474:function(t,e,n){Promise.resolve().then(n.bind(n,7568))},7568:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return DimRed}});var r=n(7437),a=n(2265),l=n(4938),o=n(8843),s=n(879),toolViz_D3ColorLegend=t=>{let{max:e=10,min:n=0}=t,l=(0,a.useRef)();return(0,a.useEffect)(()=>{(function(t,e){var n={top:10,right:2,bottom:20,left:60},r=s.Ys(t.current).style("height","50px").style("width","500px").style("position","relative").append("canvas").attr("height",1).attr("width",500-n.left-n.right).style("height",50-n.top-n.bottom+"px").style("width",500-n.left-n.right+"px").style("border","1px solid #000").style("position","absolute").style("top",n.top+"px").style("left",n.left+"px").node().getContext("2d"),a=s.BYU().range([0,500-n.left-n.right]).domain(e.domain()),l=r.createImageData(500-n.left-n.right,1);s.w6H(500-n.left-n.right).forEach(function(t){var n=s.B8C(e(a.invert(t)));l.data[4*t]=n.r,l.data[4*t+1]=n.g,l.data[4*t+2]=n.b,l.data[4*t+3]=255}),r.putImageData(l,0,0);var o=s.LLu().scale(a).tickSize(6).ticks(8);s.Ys(t.current).append("svg").attr("height","50px").attr("width","500px").style("position","absolute").style("left","0px").style("top","0px").append("g").attr("class","axis").attr("transform","translate("+n.left+","+(50-n.bottom)+")").call(o)})(l,s.cJy(s.OOA).domain([e,n]))},[]),(0,r.jsx)("div",{ref:l,id:"color-legend"})},i=n(415),d=n.n(i);let c=d()(()=>Promise.all([n.e(866),n.e(458)]).then(n.bind(n,8458)),{loadableGenerated:{webpack:()=>[8458]},ssr:!1}),Tooltip=t=>{let{interactionData:e}=t;return null===e?null:(0,r.jsxs)("div",{style:{left:.5*e.xPos+10,bottom:.5*e.yPos},className:"tooltip",children:[(0,r.jsx)(c,{structure:e.name,id:"smiles"}),(0,r.jsx)("style",{children:'\n      .tooltip {\n        position: absolute;\n        background-color: rgba(0, 0, 0, 0.8);\n        border-radius: 4px;\n        color: white;\n        font-size: 12px;\n        padding: 4px;\n        margin-left: 15px;\n        transform: translateY(-50%);\n    }\n    \n    /* Add an arrow */\n    .tooltip:after {\n        content: "";\n        position:absolute;\n        border-width: 5px;  /* Arrow width */\n        left: -10px;  /* Arrow width * 2 */\n        top:50%;\n        transform:translateY(-50%);\n        border-color: transparent black transparent transparent;\n    }\n    \n      '})]})};var ScatterPlot=t=>{let{data:e,colorProperty:n,hoverProp:l,xAxisTitle:o,yAxisTitle:i,wid:d=800,heit:c=600}=t,u={top:10,right:30,bottom:30,left:60},p=d-u.left-u.right,f=c-u.top-u.bottom,m=(0,a.useRef)(),[h,x]=(0,a.useState)(null),handleMouseOver=(t,n)=>{let[r,a]=s.cx$(t);x({xPos:r,yPos:a,name:l[e.indexOf(n)]})},handleMouseEnd=()=>{x(null)};return(0,a.useEffect)(()=>{s.Ys(m.current).selectAll("*").remove();let t=s.Ys(m.current).append("svg").attr("width",p+u.left+u.right).attr("height",f+u.top+u.bottom).append("g").attr("transform","translate(".concat(u.left,",").concat(u.top,")")),r=s.sPX().scaleExtent([.5,20]).extent([[0,0],[p,f]]).on("zoom",function(t){let e=t.transform.rescaleX(a),n=t.transform.rescaleY(d);l.call(s.LLu(e)),c.call(s.y4O(n)),h.selectAll("circle").attr("cx",t=>e(t.x)).attr("cy",t=>n(t.y))});t.append("rect").attr("width",p).attr("height",f).style("fill","none").style("pointer-events","all").attr("transform","translate(".concat(u.left,",").concat(u.top,")")).call(r);let a=s.BYU().domain([s.VV$(e,t=>t.x),s.Fp7(e,t=>t.x)]).range([0,p]),l=t.append("g").attr("transform","translate(0,".concat(f,")")).call(s.LLu(a)),d=s.BYU().domain([s.VV$(e,t=>t.y),s.Fp7(e,t=>t.y)]).range([f,0]),c=t.append("g").call(s.y4O(d));t.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",p).attr("height",f).attr("x",0).attr("y",0);let h=t.append("g").attr("clip-path","url(#clip)"),x=s.cJy().domain([1,10]).interpolator(s.OOA);h.selectAll("circle").data(e).enter().append("circle").attr("cx",t=>a(t.x)).attr("cy",t=>d(t.y)).attr("r",8).style("fill",(t,e)=>x(n[e])).style("opacity",.5).on("mouseenter",handleMouseOver).on("mouseleave",handleMouseEnd),t.append("text").attr("transform","translate(".concat(p/2,",").concat(f+u.top+20,")")).style("text-anchor","middle").style("fill","var(--text-color)").text(o),t.append("text").attr("transform","rotate(-90)").attr("y",0-u.left).attr("x",0-f/2).attr("dy","1em").style("text-anchor","middle").style("fill","var(--text-color)").text(i)},[e]),(0,r.jsxs)("div",{className:"container",style:{position:"relative"},children:[(0,r.jsx)(toolViz_D3ColorLegend,{}),(0,r.jsx)("div",{id:"dataviz_axisZoom",ref:m}),(0,r.jsx)(Tooltip,{interactionData:h})]})},u=n(4033),p=n(6462);function DimRed(){let{ligand:t}=(0,a.useContext)(l.Z),{pyodide:e}=(0,a.useContext)(o.Z),[n,s]=(0,a.useState)([]),[i,d]=(0,a.useState)(""),[c,f]=(0,a.useState)(!0),m=(0,a.useRef)(null),[h,x]=(0,a.useState)({width:800,height:600}),[y,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{d(window.location.hash),g(!1),setTimeout(()=>{runDimRed()},100)},[(0,u.useSearchParams)()]);var v=t.map(t=>t.pKi),b=t.map(t=>t.canonical_smiles);function runDimRed(){let t,n=!(arguments.length>0)||void 0===arguments[0]||arguments[0];switch(g(!1),i){case"#pca":t=1;case"#tsne":t=n?2:3}globalThis.opts=t,e.runPython("\n            from sklearn.decomposition import PCA\n            from sklearn.manifold import TSNE\n            import js\n\n            result = 0\n\n            if js.opts == 1:\n                pca = PCA(n_components=2)\n                result = pca.fit_transform(js.fp)\n            elif js.opts == 2:\n                pca = PCA(n_components=30)\n                pca_drugs = pca.fit_transform(js.fp)\n                model = TSNE(n_components=2, random_state=0, perplexity=30, n_iter=5000)\n                result = model.fit_transform(pca_drugs)\n            elif js.opts == 3:\n                model = TSNE(n_components=2, random_state=0, perplexity=30, n_iter=5000)\n                result = model.fit_transform(js.fp)\n\n            js.pca = result\n        ");let r=globalThis.pca.toJs(),a=r.map(t=>{let[e,n]=t;return{x:e,y:n}});s(a),g(!0)}return(globalThis.fp=t.map(t=>t.fingerprint),y)?(0,r.jsxs)("div",{className:"tools-container",ref:m,children:["#pca"===i&&(0,r.jsx)(r.Fragment,{}),"#tsne"===i&&(0,r.jsxs)("div",{className:"container",children:[(0,r.jsx)("input",{type:"checkbox",defaultChecked:!0,onChange:t=>{f(t.target.checked)}}),(0,r.jsx)("label",{htmlFor:"tsne_perplexity",children:"Perplexity"}),(0,r.jsx)("input",{className:"input",id:"tsne_perplexity"}),(0,r.jsx)("label",{htmlFor:"tsne_n_iter",children:"Number of Iterations"}),(0,r.jsx)("input",{className:"input",id:"tsne_n_iter"}),(0,r.jsx)("button",{className:"button",onClick:()=>runDimRed(c),children:"Run tSNE"})]}),n.length>0&&(0,r.jsx)(ScatterPlot,{data:n,colorProperty:v,hoverProp:b,xAxisTitle:"Principal Component 1",yAxisTitle:"Principal Component 2",heit:h.height-40,wid:h.width-20})]}):(0,r.jsx)("div",{className:"tools-container",children:(0,r.jsx)(p.Z,{})})}},6462:function(t,e,n){"use strict";n.d(e,{Z:function(){return Loader}});var r=n(7437);function Loader(t){let{loadingText:e="Processsing..."}=t;return(0,r.jsxs)("div",{style:{textAlign:"center"},children:[e,(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"loader"})})]})}},4938:function(t,e,n){"use strict";n.d(e,{G:function(){return LigandProvider}});var r=n(7437),a=n(2265);let l=(0,a.createContext)({ligand:[],setLigand:()=>{}});function LigandProvider(t){let{children:e}=t,[n,o]=(0,a.useState)([]);return(0,r.jsx)(l.Provider,{value:{ligand:n,setLigand:o},children:e})}e.Z=l},8843:function(t,e,n){"use strict";n.d(e,{v:function(){return PyodideProvider}});var r=n(7437),a=n(2265);let l=(0,a.createContext)({pyodide:{},setPyodide:()=>{}});function PyodideProvider(t){let{children:e}=t,[n,o]=(0,a.useState)({});return(0,r.jsx)(l.Provider,{value:{pyodide:n,setPyodide:o},children:e})}e.Z=l},415:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return dynamic}});let r=n(1024);n(2265);let a=r._(n(54));function convertModule(t){return{default:(null==t?void 0:t.default)||t}}function dynamic(t,e){let n=a.default,r={loading:t=>{let{error:e,isLoading:n,pastDelay:r}=t;return null}};"function"==typeof t&&(r.loader=t),Object.assign(r,e);let l=r.loader;return n({...r,loader:()=>null!=l?l().then(convertModule):Promise.resolve(convertModule(()=>null))})}("function"==typeof e.default||"object"==typeof e.default&&null!==e.default)&&void 0===e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},3388:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t,e){for(var n in e)Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}(e,{suspense:function(){return suspense},NoSSR:function(){return NoSSR}}),n(1024),n(2265);let r=n(4922);function suspense(){let t=Error(r.NEXT_DYNAMIC_NO_SSR_CODE);throw t.digest=r.NEXT_DYNAMIC_NO_SSR_CODE,t}function NoSSR(t){let{children:e}=t;return e}},54:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return _default}});let r=n(1024),a=r._(n(2265)),l=n(3388),_default=function(t){let e=Object.assign({loader:null,loading:null,ssr:!0},t);function LoadableComponent(t){let n=e.loading,r=a.default.createElement(n,{isLoading:!0,pastDelay:!0,error:null}),o=e.ssr?a.default.Fragment:l.NoSSR,s=e.lazy;return a.default.createElement(a.default.Suspense,{fallback:r},a.default.createElement(o,null,a.default.createElement(s,t)))}return e.lazy=a.default.lazy(e.loader),LoadableComponent.displayName="LoadableComponent",LoadableComponent}},4033:function(t,e,n){t.exports=n(290)}},function(t){t.O(0,[291,971,864,744],function(){return t(t.s=3474)}),_N_E=t.O()}]);